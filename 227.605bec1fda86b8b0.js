"use strict";(self.webpackChunkAlbionMarket=self.webpackChunkAlbionMarket||[]).push([[227],{7227:(Ie,A,d)=>{d.r(A),d.d(A,{GoldModule:()=>Se});var v=d(9808),B=d(8255),k=d(9776),N=d(7429),r=d(5e3),M=d(7423),L=d(8962),p=d(508),f=d(7579),h=(d(727),d(1159),d(3191),d(1777),d(3075)),S=(d(7322),d(7531));let J=(()=>{class a{constructor(){this.changes=new f.x,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year"}formatYearRange(e,t){return`${e} \u2013 ${t}`}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=r.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const ae={provide:new r.OlP("mat-datepicker-scroll-strategy"),deps:[k.aV],useFactory:function te(a){return()=>a.scrollStrategies.reposition()}};let oe=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=r.oAB({type:a}),a.\u0275inj=r.cJS({providers:[J,ae],imports:[[v.ez,M.ot,k.U8,B.rt,N.eL,p.BQ],L.ZD]}),a})();var V=d(4100),P=d(4004),le=d(4968);let w=(()=>{class a{constructor(){this.onMove=new f.x,this.changePoints=new f.x,this.points=[],this.insideSvg={value:!1}}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=r.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const de=["graph"],ce=["valuePoints",""];let T=(()=>{class a{constructor(e){this.com=e,this.valuePoints=[],this.loadEmitter=new r.vpe,this.pointsRender=[],this.handler=()=>{},this.loaded=!1}ngOnInit(){}ngOnChanges(e){this.ngOnChanges=t=>{this.loaded=!0,this.handler=this.render,this.handler(),this.registerEvents(),this.ngOnChanges=i=>{this.handler()}}}ngAfterViewInit(){setTimeout(()=>{this.graph?(this.com.svg=this.graph.nativeElement,this.loadEmitter.emit(!0)):console.log("svg not loaded")},0)}reLoad(){this.handler()}render(){if(this.valuePoints.length<2)throw new Error("Cannot render with less than 2 points");const e=this.graph.nativeElement,t=this.valuePoints[0],i=this.valuePoints[this.valuePoints.length-1],s=this.valuePoints.reduce((_,g)=>_.price>g.price?g:_).price,o=this.valuePoints.reduce((_,g)=>_.price<g.price?g:_).price,l=i.timestamp-t.timestamp,m=o-s,u=[];u.push({x:0,y:e.clientHeight});for(let _ of this.valuePoints)u.push(he(_,{price:s,timestamp:t.timestamp},{price:m,timestamp:l},{x:e.clientWidth,y:e.clientHeight}));u.push({x:e.clientWidth,y:e.clientHeight}),this.pointsRender=function pe(a){const n=[];for(let e of a)n.push(e.x,e.y);return n}(u),this.com.changePoints.next(u),this.com.points=u,this.com.minMaxValue=[{price:s,timestamp:this.valuePoints[0].timestamp},{price:m,timestamp:l}]}registerEvents(){(0,le.R)(this.graph.nativeElement,"mousemove").subscribe(e=>this.com.onMove.next(e))}mouseEnterAndLeave(e){this.loaded&&(this.mouseEnterAndLeave=t=>this.com.insideSvg.value=t,this.mouseEnterAndLeave(e))}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(w))},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-graph","valuePoints",""]],viewQuery:function(e,t){if(1&e&&r.Gf(de,5),2&e){let i;r.iGM(i=r.CRH())&&(t.graph=i.first)}},inputs:{valuePoints:"valuePoints"},outputs:{loadEmitter:"load"},features:[r.TTD],attrs:ce,decls:4,vars:1,consts:[[1,"card"],["id","graph",3,"mouseenter","mouseleave"],["graph",""],["fill","gold"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.O4$(),r.TgZ(1,"svg",1,2),r.NdJ("mouseenter",function(){return t.mouseEnterAndLeave(!0)})("mouseleave",function(){return t.mouseEnterAndLeave(!1)}),r._UZ(3,"polygon",3),r.qZA(),r.qZA()),2&e&&(r.xp6(3),r.uIk("points",t.pointsRender))},styles:[".card[_ngcontent-%COMP%]{height:400px}.card[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:100%}.label[_ngcontent-%COMP%]{width:200px;height:50px;background-color:#fff;border-radius:3px;border:1px solid #000;padding:5px}.label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:0;margin:0;font-size:12px}.circle[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:100px;background-color:green;border:.5px solid #000}.circle[_ngcontent-%COMP%]:hover{width:15px;height:15px}svg[_ngcontent-%COMP%]{overflow:hidden}"]}),a})();function he(a,n,e,t){return{x:t.x*((a.timestamp-n.timestamp)/e.timestamp),y:t.y*(1-(a.price-n.price)/e.price)}}const ue=["point","","display","","containerSize",""];let F=(()=>{class a{constructor(e){this.hostRef=e,this.value={price:0,timestamp:0},this.point={x:0,y:0},this.display=!1,this.offset={x:20,y:10}}ngOnInit(){}ngOnChanges(e){this.ngOnChanges=t=>{t.point&&setTimeout(()=>{const i=this.hostRef.nativeElement;i.style.left=this.getX(this.point.x,i.clientWidth,this.offset.x,this.containerSize.x)+"px",i.style.top=this.getY(this.point.y,i.clientHeight+this.offset.y,this.containerSize.y)+"px"},0)}}getX(e,t,i,s){return(t+=i)+e>s?e-t:e+i}getY(e,t,i){return Math.max(2,Math.min(i-t-2,e-t/2))}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(r.SBq))},a.\u0275cmp=r.Xpm({type:a,selectors:[["value-point-label","point","","display","","containerSize",""]],hostVars:2,hostBindings:function(e,t){2&e&&r.Udp("display",t.display?"inline-block":"none")},inputs:{value:"value",point:"point",display:"display",containerSize:"containerSize",offset:"offset"},features:[r.TTD],attrs:ue,decls:5,vars:5,template:function(e,t){1&e&&(r.TgZ(0,"p"),r._uU(1),r.qZA(),r.TgZ(2,"p"),r._uU(3),r.ALo(4,"date"),r.qZA()),2&e&&(r.xp6(1),r.Oqu(t.value.price),r.xp6(2),r.Oqu(r.xi3(4,2,t.value.timestamp,"short")))},pipes:[v.uU],styles:["[_nghost-%COMP%]{display:inline-block;position:absolute;border-radius:10px;width:160px;aspect-ratio:3/1;background-color:#fff;box-shadow:2px 2px 3px 1px #00000078;-webkit-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);-moz-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);padding:4px}[_nghost-%COMP%] > p[_ngcontent-%COMP%]{width:100%;margin:0}"]}),a})();const _e=["cursor"],me=function(a,n){return{x:a,y:n}};let O=(()=>{class a{constructor(e){this.linkSev=e,this.cursorWidth=6,this.values=[],this.$unsuscriber=new f.x,this.inSvg={value:!1},this.val={price:0,timestamp:0},this.point={x:0,y:0}}ngOnInit(){this.reload(),this.inSvg=this.linkSev.insideSvg,this.linkSev.onMove.subscribe(e=>{this.moveLabel(e)})}ngOnDestroy(){this.$unsuscriber.next(),this.$unsuscriber.unsubscribe()}reload(){const e=this.linkSev.svg.getBoundingClientRect();this.boundX=e.x,this.svgWidth=e.width,this.svgHeight=e.height}moveLabel(e){const t=e.clientX-this.boundX,i=this.calculateLabelY(t);this.point={x:t,y:i},this.cursorRef.nativeElement.style.left=t+"px",this.cursorRef.nativeElement.style.top=i+"px",this.val=this.toValue({x:t,y:i})}calculateLabelY(e){const t=this.linkSev.points.slice().reverse().find(s=>s.x<=e),i=this.linkSev.points.find(s=>s.x>=e);return t?(i.y-t.y)*(e-t.x)/(i.x-t.x)+t.y:i.y}toValue(e){const t=this.linkSev.minMaxValue[0],i=this.linkSev.minMaxValue[1],s_x=this.svgWidth;return{price:Math.floor(100*(-1*i.price*(e.y/this.svgHeight-1)+t.price))/100,timestamp:i.timestamp*e.x/s_x+t.timestamp}}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(w))},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-label"]],viewQuery:function(e,t){if(1&e&&r.Gf(_e,5),2&e){let i;r.iGM(i=r.CRH())&&(t.cursorRef=i.first)}},inputs:{cursorWidth:"cursorWidth",values:"values"},decls:3,vars:9,consts:[[3,"value","display","containerSize","point"],[1,"cursor"],["cursor",""]],template:function(e,t){1&e&&(r._UZ(0,"value-point-label",0),r._UZ(1,"div",1,2)),2&e&&(r.Q6J("value",t.val)("display",t.inSvg.value)("containerSize",r.WLB(6,me,t.svgWidth,t.svgHeight))("point",t.point),r.xp6(1),r.Udp("display",t.inSvg.value?"inline-block":"none"))},directives:[F],styles:["[_nghost-%COMP%]{position:absolute;top:0}.label[_ngcontent-%COMP%]{position:absolute;border-radius:10px;width:160px;aspect-ratio:3/1;background-color:#fff;box-shadow:2px 2px 3px 1px #00000078;-webkit-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);-moz-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);padding:4px;top:0}.label[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{width:100%;margin:0}.cursor[_ngcontent-%COMP%]{position:absolute;border-radius:50px;width:6px;aspect-ratio:1;background-color:#000}.d-none[_ngcontent-%COMP%]{display:none}"]}),a})();const ge=function(a,n,e){return{top:a,left:n,width:e}};function ve(a,n){if(1&a){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("mouseenter",function(){const s=r.CHM(e).index,o=r.oxw();return o.pointHover=!0,o.setPointValue(s)})("mouseout",function(){return r.CHM(e),r.oxw().pointHover=!1}),r.qZA()}if(2&a){const e=n.$implicit,t=r.oxw();r.Q6J("ngStyle",r.kEZ(1,ge,e.y+"px",e.x+"px",t.size+"px"))}}let Y=(()=>{class a{constructor(e){this.linkSev=e,this.size=6,this.values=[],this.points=[],this.value={price:0,timestamp:0},this.point={x:0,y:0},this.pointHover=!1,this.containerSize={x:0,y:0}}reload(){const e=this.linkSev.svg.getBoundingClientRect();this.containerSize={x:e.width,y:e.height}}ngOnInit(){this.linkSev.changePoints.pipe((0,P.U)(e=>e.slice(1,-1).map(t=>({x:t.x-this.size/2.5,y:t.y-this.size/2.5})))).subscribe(e=>this.points=e)}ngAfterViewInit(){this.reload()}setPointValue(e){this.value=this.values[e],this.point={x:this.points[e].x+this.size/2,y:this.points[e].y+this.size/2}}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(w))},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-points"]],inputs:{size:"size",values:"values"},decls:2,vars:5,consts:[["class","point",3,"ngStyle","mouseenter","mouseout",4,"ngFor","ngForOf"],[3,"value","point","display","containerSize"],[1,"point",3,"ngStyle","mouseenter","mouseout"]],template:function(e,t){1&e&&(r.YNc(0,ve,1,5,"div",0),r._UZ(1,"value-point-label",1)),2&e&&(r.Q6J("ngForOf",t.points),r.xp6(1),r.Q6J("value",t.value)("point",t.point)("display",t.pointHover)("containerSize",t.containerSize))},directives:[v.sg,F,v.PC],styles:["[_nghost-%COMP%]{position:absolute;top:0}.point[_ngcontent-%COMP%]{position:absolute;background-color:#f5ad27;width:6px;aspect-ratio:1;border-radius:50px}.label[_ngcontent-%COMP%]{position:absolute;border-radius:10px;width:160px;aspect-ratio:3/1;background-color:#fff;box-shadow:2px 2px 3px 1px #00000078;-webkit-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);-moz-box-shadow:2px 2px 3px 1px rgba(0,0,0,.47);padding:4px;top:0}.label[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:block;width:100%}.label[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin:0}"]}),a})();function fe(a,n){return e=>"object"==typeof e.value&&e.value[a]&&e.value[n]&&function De(a,n){return a.getTime()>=n.getTime()}(new Date(e.value[a]),new Date(e.value[n]))?{samedate:!0}:null}var ye=d(520);function Ce(a,n){1&a&&(r.TgZ(0,"p",13),r._uU(1,"Invalid date"),r.qZA())}function be(a,n){1&a&&(r.TgZ(0,"p",13),r._uU(1,"Invalid date"),r.qZA())}function Me(a,n){1&a&&(r.TgZ(0,"p",13),r._uU(1,"Date too low"),r.qZA())}function xe(a,n){if(1&a&&(r.ynx(0),r._UZ(1,"app-points",14),r._UZ(2,"app-label",15),r.BQk()),2&a){const e=r.oxw();r.xp6(1),r.Q6J("size",10)("values",e.valuePoints),r.xp6(1),r.Q6J("values",e.valuePoints)}}const we=[{path:"",pathMatch:"full",component:(()=>{class a{constructor(e){this._http=e,this.range=new h.cw({start:new h.NI("",h.kI.required),end:new h.NI("",h.kI.required)},{validators:fe("start","end")}),this.valuePoints=[],this.messageError=null,this.svgLoad=!1}onResize(){this.graphComponent.reLoad(),this.labelComponent.reload(),this.pointsComponent.reload()}ngOnInit(){}submit(){this.range.invalid||this.getGoldPrices(new Date(this.range.controls.start.value),new Date(this.range.controls.end.value)).pipe((0,P.U)(e=>e.map(t=>({price:t.price,timestamp:new Date(t.timestamp).getTime()})))).subscribe(e=>this.valuePoints=e)}getGoldPrices(e,t){return this._http.get("https://www.albion-online-data.com/api/v2/stats/gold?date="+e.toJSON()+"&end_date="+t.toJSON())}load(){this.svgLoad=!0}}return a.\u0275fac=function(e){return new(e||a)(r.Y36(ye.eN))},a.\u0275cmp=r.Xpm({type:a,selectors:[["app-gold-market"]],viewQuery:function(e,t){if(1&e&&(r.Gf(T,5),r.Gf(O,5),r.Gf(Y,5)),2&e){let i;r.iGM(i=r.CRH())&&(t.graphComponent=i.first),r.iGM(i=r.CRH())&&(t.labelComponent=i.first),r.iGM(i=r.CRH())&&(t.pointsComponent=i.first)}},hostBindings:function(e,t){1&e&&r.NdJ("resize",function(){return t.onResize()},!1,r.Jf7)},decls:17,vars:6,consts:[[1,"container"],[1,"button-container"],[3,"formGroup","ngSubmit"],[1,"field-container"],[1,"field"],["type","date","formControlName","start","name","start"],["class","error",4,"ngIf"],["type","date","formControlName","end","name","end"],[1,"btn-cont"],["type","submit","mat-raised-button","","color","primary"],[1,"svg-container",2,"position","relative"],[3,"valuePoints","load"],[4,"ngIf"],[1,"error"],[3,"size","values"],[3,"values"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.TgZ(2,"form",2),r.NdJ("ngSubmit",function(){return t.submit()}),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r._UZ(5,"input",5),r.YNc(6,Ce,2,0,"p",6),r.qZA(),r.TgZ(7,"div",4),r._UZ(8,"input",7),r.YNc(9,be,2,0,"p",6),r.YNc(10,Me,2,0,"p",6),r.qZA(),r.qZA(),r.TgZ(11,"div",8),r.TgZ(12,"button",9),r._uU(13,"Buscar"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(14,"div",10),r.TgZ(15,"app-graph",11),r.NdJ("load",function(){return t.load()}),r.qZA(),r.YNc(16,xe,3,3,"ng-container",12),r.qZA(),r.qZA()),2&e&&(r.xp6(2),r.Q6J("formGroup",t.range),r.xp6(4),r.Q6J("ngIf",t.range.controls.start.invalid&&t.range.controls.start.touched),r.xp6(3),r.Q6J("ngIf",t.range.controls.end.invalid&&t.range.controls.end.touched),r.xp6(1),r.Q6J("ngIf",t.range.errors&&t.range.errors.samedate),r.xp6(5),r.Q6J("valuePoints",t.valuePoints),r.xp6(1),r.Q6J("ngIf",t.svgLoad))},directives:[h._Y,h.JL,h.sg,h.Fj,h.JJ,h.u,v.O5,M.lW,T,Y,O],styles:[".button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.svg-container[_ngcontent-%COMP%]{margin-top:20px;overflow:hidden}form[_ngcontent-%COMP%]{margin-top:10px}form[_ngcontent-%COMP%] > .field-container[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:1fr 1fr;grid-gap:20px;gap:20px}form[_ngcontent-%COMP%] > .field-container[_ngcontent-%COMP%] > .field[_ngcontent-%COMP%]   p.error[_ngcontent-%COMP%]{color:#d30d0d;word-break:break-all}form[_ngcontent-%COMP%]   .btn-cont[_ngcontent-%COMP%]{margin-top:10px;display:flex;justify-content:flex-end}"]}),a})()}];let Ae=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=r.oAB({type:a}),a.\u0275inj=r.cJS({imports:[[V.Bz.forChild(we)],V.Bz]}),a})();var ke=d(773);let Se=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=r.oAB({type:a}),a.\u0275inj=r.cJS({imports:[[v.ez,Ae,oe,p.XK,ke.Cq,h.UX,S.c,M.ot]]}),a})()}}]);